- name: install git
  package:
    name: git
    state: present

- name: install oasis repos
  git:
    repo: "git://github.com/OasisLMF/{{ item.repo }}.git"
    version: "{{ item.tag }}"
    depth: 1
    dest: "/home/{{ admin_user }}/{{ item.repo }}"
    force: yes
  with_items:
    - { repo: "{{ git_api }}", tag: "{{ branch_api }}" }
    - { repo: "{{ git_ui }}", tag: "{{ branch_ui }}" }
    - { repo: "{{ git_piwind }}", tag: "{{ branch_piwind }}" }

- name: run oasis api container
#   shell: "OASIS_MODEL_DATA_DIR=/home/{{ admin_user }}/{{ git_piwind }}; docker-compose -f /home/{{ admin_user }}/{{ git_api }}/docker-compose.yml up -d"
  docker_service:
    project_src: "/home/{{ admin_user }}/{{ git_api }}"
  environment:
    OASIS_MODEL_DATA_DIR: "/home/{{ admin_user }}/{{ git_piwind }}"
  register: oasis_api_output

- name: docker-compose debug - oasis api
  debug:
    var: oasis_api_output

- name: create docker network shiny-net
  docker_network:
    name: "{{ docker_network }}"

- name: pull container coreoasis/oasisui_app
  docker_image:
    name: "{{ docker_ui }}"
    tag: "{{ docker_tag_ui }}"

- name: run oasis ui container
  # shell: "docker-compose -f /home/{{ admin_user }}/{{ git_ui }}/docker-compose.yml up -d"
  docker_service:
    project_src: "/home/{{ admin_user }}/{{ git_ui }}"
  register: oasis_ui_output

- name: docker-compose debug - oasis ui
  debug:
    var: oasis_ui_output
