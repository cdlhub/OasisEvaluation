- name: install git
  package:
    name: git
    state: present

- name: install oasis repos
  git:
    repo: "git://github.com/{{ item.user }}/{{ item.repo }}.git"
    version: "{{ item.version }}"
    depth: 1
    dest: "/home/{{ admin_user }}/{{ item.repo }}"
    force: yes
  with_items:
    - { user: "{{ git_user_api }}", repo: "{{ git_repo_api }}", tag: "{{ git_version_api }}" }
    - { user: "{{ git_user_ui }}", repo: "{{ git_repo_ui }}", tag: "{{ git_version_ui }}" }
    - { user: "{{ git_user_piwind }}", repo: "{{ git_repo_piwind }}", tag: "{{ git_version_piwind }}" }
  
- name: run oasis api container
  docker_service:
    project_src: "/home/{{ admin_user }}/{{ git_api }}"
    pull: true
  environment:
    OASIS_MODEL_DATA_DIR: "/home/{{ admin_user }}/{{ git_piwind }}"
  register: oasis_api_output

# - name: docker-compose debug - oasis api
#   debug:
#     var: oasis_api_output

- name: create docker network shiny-net
  docker_network:
    name: "{{ docker_network }}"

- name: run oasis ui container
  docker_service:
    project_src: "/home/{{ admin_user }}/{{ git_ui }}"
    pull: true
  register: oasis_ui_output

# - name: docker-compose debug - oasis ui
#   debug:
#     var: oasis_ui_output
